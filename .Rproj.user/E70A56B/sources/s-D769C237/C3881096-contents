---
title: "Crime Analysis"
author: "Eric Born"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE
)
library(plotly)
library(corrplot)

# read the csv file into R
dat <- read.csv(file='F:/Code projects/BU/555 - analysis and vis/Final/SD-crime.csv', sep = ',')

# Remove columns 2-6, 8-9, 11-12, 15, 16 which are not being used during this analysis
crime.df <- dat[, c(1,7,10,13,14)]

# create a new column containing just the year
crime.df$year <- substr(crime.df$month, 5, 6)

# summary stats for data
full.stats <- data.frame('Measure' = c('Violent Crime', 'Burglary', 'Thefts', 
                                       'Vehicle Theft'),
                         'Min' = c(summary(crime.df$Total.Violent.Crime)[[1]],
                                   summary(crime.df$Total.Burglary)[[1]],
                                   summary(crime.df$Total.Thefts)[[1]],
                                   summary(crime.df$Motor.Vehicle.Theft)[[1]]),
                         
                         'q1' = c(summary(crime.df$Total.Violent.Crime)[[2]],
                                  summary(crime.df$Total.Burglary)[[2]],
                                     summary(crime.df$Total.Thefts)[[2]],
                                  summary(crime.df$Motor.Vehicle.Theft)[[2]]),
                         
                         'Median' = c(summary(crime.df$Total.Violent.Crime)[[3]],
                                      summary(crime.df$Total.Burglary)[[3]],
                                      summary(crime.df$Total.Thefts)[[3]],
                                      summary(crime.df$Motor.Vehicle.Theft)[[3]]),
                         
                         'Mean' = c(summary(crime.df$Total.Violent.Crime)[[4]],
                                    summary(crime.df$Total.Burglary)[[4]],
                                    summary(crime.df$Total.Thefts)[[4]],
                                    summary(crime.df$Motor.Vehicle.Theft)[[4]]),
                         
                         'q3' = c(summary(crime.df$Total.Violent.Crime)[[5]],
                                  summary(crime.df$Total.Burglary)[[5]],
                                  summary(crime.df$Total.Thefts)[[5]],
                                  summary(crime.df$Motor.Vehicle.Theft)[[5]]),
                         
                         'Max' = c(summary(crime.df$Total.Violent.Crime)[[6]],
                                   summary(crime.df$Total.Burglary)[[6]],
                                   summary(crime.df$Total.Thefts)[[6]],
                                   summary(crime.df$Motor.Vehicle.Theft)[[6]]))

# reset factors to order by Measure column
full.stats$Measure <- factor(full.stats$Measure, 
                             levels = c(as.character(full.stats$Measure)))

# Convert factors to character
full.stats$Measure <- as.character(full.stats$Measure)

# create table for summary stats
summary.stat.table <- plot_ly(
  type = 'table',
  height = 180,
  #width = 700,
  columnwidth = c(25, 15, 15, 15, 15),
  header = list(
    values = c('Measure', 'Min', '1st Q', 'Median', 'Mean', '3rd Q', 'Max'),
    line = list(width = 1, color = 'black'),
    fill = list(color = c('#1f77b4', '#1f77b4')),
    font = list(famile = 'Arial', size = 14, color = 'white')
  ),
  cells = list(
    values = rbind(full.stats$Measure, full.stats$Min, full.stats$q1, full.stats$Median, 
                   round(full.stats$Mean,1), full.stats$q3, full.stats$Max),
    align = c('center'),
    line = list(width = 1, color = 'black')
  ))

# create a new column to track changes from month to month
for (row in 1:nrow(crime.df)){
  if (is.na(crime.df$Total.Violent.Crime[row + 1]
            - crime.df$Total.Violent.Crime[row])) {
  } 
  else {
    crime.df$violent.change[row + 1] <- (crime.df$Total.Violent.Crime[row + 1]
                                         - crime.df$Total.Violent.Crime[row])
    crime.df$burglary.change[row + 1] <- (crime.df$Total.Burglary[row  + 1]
                                          - crime.df$Total.Burglary[row])
    crime.df$thefts.change[row + 1] <- (crime.df$Total.Thefts[row + 1]
                                        - crime.df$Total.Thefts[row])
    crime.df$vehicle.change[row + 1] <- (crime.df$Motor.Vehicle.Theft[row + 1]
                                         - crime.df$Motor.Vehicle.Theft[row])
  }
}

# create a dataframe containing only the monthly changes
crime.change <- crime.df[, c(7:10)]

```

## Overview

Utilizing R, I performed a study on the overall crime levels to gain an understanding if there were any correlations between the types of crimes being committed.

The data being used was from the San Diego Automated Regional Justice Information System (ARJIS) and contains the following columns: Murder, Rape, Armed Robbery, Strong Arm Robbery, Aggravated Assault, Total Violent Crime, Residential Burglary, Non-Residential Burglary, Total Burglary, Theft >= $400, Theft < $400, Total Thefts, Motor Vehicle Theft, Total Property Crime and Crime Index.

This data is presented as counts of occurrences by month from January 2008 to present day.

I chose to eliminate each of the crime subcategories and instead focus on the total number of violent crimes, burglaries, thefts and vehicle thefts along with the month they occurred, for a total of five columns.

Total Violent Crime equals the sum of murders, rapes, robberies, and aggravated assaults. Total Burglary equals the sum of residential and non-residential burglaries. Total Thefts equals the sum of thefts >= $400 and thefts < $400.

There are 132 total observations, one per month for 11 years.

The original data can be found here: http://crimestats.arjis.org/default.aspx

### Summary

Looking at the five number summary showing the total occurrences per category across the entire dataset. We can see that on average, theft occurs three to four times more often than the any of the other categories of crime and that the other three categories happen at close to the same frequency as each other.

```{r echo=FALSE}
# Plot summary table
summary.stat.table
```

To study the change over time, I first calculated the change per category from one month to the next and then ran a summary on that data. From the summary you can see that the minimum and maximum, which is the measurement of the decrease or increase in total occurences from one month to the next, were close to the same for violent crime, and theft, but the largest decrease for burglary was 79 greater than the maximum increase, 303 compared to 224 and it was the opposite for vehicle theft, 423 as the highest increase versus 382 as the lowest decrease.

```{r echo=FALSE}
# Plot summary table
summary.stat.table
```


## Research Questions
My two research questions was to evaluate the correlation and overall trends between the total number of violent crimes, burglaries, thefts and vehicle thefts over time to see if they have remained the same.

```{r echo=FALSE}



```